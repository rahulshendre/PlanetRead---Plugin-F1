<!DOCTYPE html>
<!-- This document forms the dockable panel. The button is the <input> tag below. The <style> formats the button. 

        The extendscript is called through the <script type="text/javascript"> tag, which then routes it to use the adobe_cep_.evalScript to interpret that Javascript into Extendscript -->
<html>
<head>
    <meta charset="utf-8">
    <title>CapsPanel</title>
    <script src="./lib/CSInterface.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap');
        body {
            background: #1a1a1a;
            color: #e3e6ea;
            font-family: 'Roboto', Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .panel-container {
            background: #23272e;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4);
            padding: 32px 28px 24px 28px;
            margin: 32px auto;
            max-width: 400px;
            min-width: 320px;
        }
        h2 {
            color: #6ec1ff;
            font-weight: 600;
            margin-bottom: 18px;
            letter-spacing: 0.5px;
            font-size: 2rem;
            text-shadow: 0 2px 12px #2196f355, 0 1px 0 #23272e;
        }
        .input-group {
            margin-bottom: 22px;
            text-align: left;
        }
        label {
            font-size: 15px;
            color: #b0b8c1;
            margin-bottom: 6px;
            display: block;
        }
        .info {
            display: inline-block;
            margin-left: 6px;
            color: #6ec1ff;
            cursor: pointer;
            font-size: 15px;
            vertical-align: middle;
            position: relative;
        }
        .info:hover .tooltip {
            opacity: 1;
            pointer-events: auto;
        }
        .tooltip {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 120%;
            background: #23272e;
            color: #e3e6ea;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 13px;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            z-index: 10;
        }
        input[type="file"] {
            background: #181c22;
            color: #e3e6ea;
            border: 1px solid #2d3748;
            border-radius: 6px;
            padding: 8px 0 8px 8px;
            margin-bottom: 0;
            font-size: 15px;
            transition: border 0.2s;
        }
        input[type="file"]:hover, input[type="file"]:focus {
            border-color: #6ec1ff;
        }
        .slider-row {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-top: 0;
            margin-bottom: 0;
        }
        input[type="range"] {
            width: 180px;
            height: 8px;
            background: #23272e;
            border-radius: 4px;
            outline: none;
            margin: 0;
            box-shadow: 0 1px 4px rgba(33,150,243,0.08);
            transition: box-shadow 0.2s;
            -webkit-appearance: none;
            vertical-align: middle;
        }
        input[type="range"]:focus {
            box-shadow: 0 0 0 2px #6ec1ff55;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2196f3 0%, #6ec1ff 100%);
            box-shadow: 0 2px 8px rgba(33,150,243,0.18);
            border: 2px solid #fff;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            margin-top: -6px;
        }
        input[type="range"]:hover::-webkit-slider-thumb,
        input[type="range"]:focus::-webkit-slider-thumb {
            background: linear-gradient(135deg, #6ec1ff 0%, #2196f3 100%);
            box-shadow: 0 4px 16px rgba(33,150,243,0.28);
        }
        input[type="range"]::-ms-fill-lower {
            background: #23272e;
        }
        input[type="range"]::-ms-fill-upper {
            background: #23272e;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2196f3 0%, #6ec1ff 100%);
            box-shadow: 0 2px 8px rgba(33,150,243,0.18);
            border: 2px solid #fff;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
        }
        input[type="range"]:hover::-moz-range-thumb,
        input[type="range"]:focus::-moz-range-thumb {
            background: linear-gradient(135deg, #6ec1ff 0%, #2196f3 100%);
            box-shadow: 0 4px 16px rgba(33,150,243,0.28);
        }
        input[type="range"]::-ms-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2196f3 0%, #6ec1ff 100%);
            box-shadow: 0 2px 8px rgba(33,150,243,0.18);
            border: 2px solid #fff;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
        }
        input[type="range"]:hover::-ms-thumb,
        input[type="range"]:focus::-ms-thumb {
            background: linear-gradient(135deg, #6ec1ff 0%, #2196f3 100%);
            box-shadow: 0 4px 16px rgba(33,150,243,0.28);
        }
        input[type="range"]::-webkit-slider-runnable-track {
            height: 6px;
            background: #23272e;
            border-radius: 4px;
        }
        input[type="range"]::-moz-range-track {
            height: 6px;
            background: #23272e;
            border-radius: 4px;
        }
        input[type="range"]::-ms-fill-lower,
        input[type="range"]::-ms-fill-upper {
            background: #23272e;
        }
        input[type="range"]:focus::-webkit-slider-thumb {
            outline: 2px solid #6ec1ff;
        }
        input[type="range"]:focus::-moz-range-thumb {
            outline: 2px solid #6ec1ff;
        }
        input[type="range"]:focus::-ms-thumb {
            outline: 2px solid #6ec1ff;
        }
        input[type="range"]::-ms-tooltip {
            display: none;
        }
        /* Remove default focus outline for range */
        input[type="range"]:focus {
            outline: none;
        }
        /* Hide number input arrows */
        input[type="number"] {
            background: #181c22;
            color: #e3e6ea;
            border: 1px solid #2d3748;
            border-radius: 6px;
            padding: 4px 8px;
            width: 60px;
            font-size: 15px;
            margin-left: 0;
            transition: border 0.2s;
            height: 28px;
            box-sizing: border-box;
            vertical-align: middle;
        }
        input[type="number"]:hover, input[type="number"]:focus {
            border-color: #6ec1ff;
            outline: none;
        }
        #runButton {
            background: linear-gradient(90deg, #2196f3 0%, #6ec1ff 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 0;
            width: 100%;
            font-size: 16px;
            font-weight: 500;
            margin-top: 18px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(33,150,243,0.08);
            cursor: pointer;
            transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
        }
        #runButton:hover, #runButton:focus {
            background: linear-gradient(90deg, #6ec1ff 0%, #2196f3 100%);
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 4px 16px rgba(33,150,243,0.18);
            outline: none;
        }
        #status {
            min-height: 22px;
            margin-top: 8px;
            font-size: 14px;
            color: #e3e6ea;
            text-align: center;
            transition: color 0.2s;
        }
        #status.error {
            color: #ff5c5c;
        }
        #status.success {
            color: #3ec46d;
            font-weight: 500;
            letter-spacing: 0.2px;
            text-shadow: 0 1px 4px rgba(62,196,109,0.12);
        }
        .divider {
            height: 1px;
            background: #2d3748;
            margin: 24px 0 18px 0;
            border: none;
        }
        .custom-file-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #181c22;
            border: 1px solid #2d3748;
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 0;
        }
        #scriptFileInput {
            display: none;
        }
        #customFileButton {
            background: linear-gradient(90deg, #2196f3 0%, #6ec1ff 100%);
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 7px 18px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
            outline: none;
        }
        #customFileButton:hover, #customFileButton:focus {
            background: linear-gradient(90deg, #6ec1ff 0%, #2196f3 100%);
            transform: translateY(-1px) scale(1.03);
            box-shadow: 0 2px 8px rgba(33,150,243,0.18);
        }
        #customFileName {
            color: #b0b8c1;
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 160px;
        }
        .help-btn {
            position: absolute;
            top: 18px;
            right: 24px;
            background: none;
            border: none;
            color: #6ec1ff;
            font-size: 17px;
            cursor: pointer;
            padding: 2px 8px;
            border-radius: 5px;
            transition: background 0.18s;
        }
        .help-btn:hover, .help-btn:focus {
            background: #23272e;
            color: #2196f3;
            outline: none;
        }
        .help-modal-backdrop {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.45);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .help-modal {
            background: #23272e;
            color: #e3e6ea;
            border-radius: 10px;
            box-shadow: 0 6px 32px rgba(0,0,0,0.35);
            padding: 28px 28px 18px 28px;
            max-width: 370px;
            width: 95%;
            position: relative;
            font-size: 15px;
        }
        .help-modal h3 {
            color: #6ec1ff;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 19px;
        }
        .help-modal .close-btn {
            position: absolute;
            top: 10px;
            right: 12px;
            background: none;
            border: none;
            color: #b0b8c1;
            font-size: 20px;
            cursor: pointer;
            border-radius: 4px;
            padding: 0 6px;
            transition: background 0.18s;
        }
        .help-modal .close-btn:hover, .help-modal .close-btn:focus {
            background: #181c22;
            color: #ff5c5c;
            outline: none;
        }
        strong, b {
            color: #6ec1ff;
            font-weight: 700;
            font-size: 1.08em;
            text-shadow: 0 1px 8px #2196f355;
            letter-spacing: 0.02em;
        }
        /* Remove color from bold/strong in help modal, keep only weight */
        .help-modal strong, .help-modal b {
            color: inherit;
            font-weight: 600;
            text-shadow: none;
        }
        @media (max-width: 480px) {
            .panel-container {
                padding: 18px 4px 12px 4px;
                min-width: unset;
            }
        }
    </style>
</head>
<body>
    <div class="panel-container" style="position:relative;">
        <button class="help-btn" id="helpBtn" title="Help">&#9432; Help</button>
        <h2>Captions Creator for Premiere Pro</h2>
        <form id="subtitleForm" autocomplete="off" onsubmit="return false;">
            <div class="input-group">
                <label for="scriptFileInput">
                    Subtitle Script File
                    <span class="info">&#9432;
                        <span class="tooltip">File must be saved as UTF-16 LE (see Help for details).</span>
                    </span>
                </label>
                <div class="custom-file-input-wrapper">
                    <input type="file" id="scriptFileInput" accept=".txt" />
                    <button type="button" id="customFileButton" tabindex="0">Choose File</button>
                    <span id="customFileName">No file chosen</span>
                </div>
            </div>
            <div class="input-group">
                <label for="wordSpacingSlider">
                    Word Spacing (points): <span id="wordSpacingValue">0.0</span>
                    <span class="info">&#9432;
                        <span class="tooltip">Adjust the space between words in the generated subtitles. 0 = normal, 15 = very wide.</span>
                    </span>
                </label>
                <div class="slider-row">
                    <input type="range" id="wordSpacingSlider" min="0" max="15" value="0" step="0.1">
                    <input type="number" id="wordSpacingInput" min="0" max="15" value="0" step="0.1">
                </div>
            </div>
            <hr class="divider" />
            <button id="runButton" type="button" title="Generate subtitle track in Premiere Pro from your text file.">Create Subtitles</button>
        </form>
        <div id="status"></div>
    </div>
    <!-- Help Modal (hidden by default) -->
    <div id="helpModalBackdrop" class="help-modal-backdrop" style="display:none;">
        <div class="help-modal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
            <button class="close-btn" id="closeHelpModal" title="Close Help">&times;</button>
            <h3 id="helpModalTitle">Help & Instructions</h3>
            <div>
                <strong>File requirements:</strong><br>
                &bull; Use a plain text file (.txt) with one subtitle line per row.<br>
                &bull; <b>File must be saved as UTF-16 LE encoding for best compatibility.</b><br><br>
                <strong>Why UTF-16 LE?</strong><br>
                This encoding ensures all languages and special characters are read correctly by the extension.<br><br>
                <strong>How to save as UTF-16 LE:</strong><br>
                1. Open your file in Notepad (or any text editor).<br>
                2. Go to <b>File &gt; Save As...</b><br>
                3. In the <b>Encoding</b> dropdown, select <b>Unicode</b> (UTF-16 LE).<br>
                4. Click <b>Save</b>.<br>
                <em>In Notepad, "Unicode" means UTF-16 LE.</em><br><br>
                <strong>Steps to use this panel:</strong><br>
                1. Choose your subtitle script file.<br>
                2. Adjust word spacing if needed.<br>
                3. Click <b>Create Subtitles</b>.<br>
                4. Check Premiere Pro's event panel for status.<br>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        // Word spacing slider and input handling
        var slider = document.getElementById('wordSpacingSlider');
        var input = document.getElementById('wordSpacingInput');
        var valueLabel = document.getElementById('wordSpacingValue');
        slider.oninput = function() {
            input.value = slider.value;
            valueLabel.textContent = slider.value;
        };
        input.oninput = function() {
            slider.value = input.value;
            valueLabel.textContent = input.value;
        };
        document.getElementById('runButton').onclick = function() {
            var fileInput = document.getElementById('scriptFileInput');
            var statusDiv = document.getElementById('status');
            statusDiv.className = '';
            if (!fileInput.files || fileInput.files.length === 0) {
                statusDiv.textContent = 'Please select a .txt file.';
                statusDiv.className = 'error';
                return;
            }
            var file = fileInput.files[0];
            var filePath = file.path || file.webkitRelativePath || file.name;
            if (!filePath) {
                statusDiv.textContent = 'Could not get file path.';
                statusDiv.className = 'error';
                return;
            }
            var wordSpacing = parseFloat(input.value);
            if (isNaN(wordSpacing) || wordSpacing < 0) wordSpacing = 0;
            if (wordSpacing > 15) wordSpacing = 15;
            var cs = new CSInterface();
            var safePath = filePath.replace(/\\/g, "\\\\");
            cs.evalScript('$.runScript.createSubtitlesFromFile("' + safePath + '", ' + wordSpacing + ')');
            statusDiv.textContent = 'Subtitle creation triggered. Check Premiere Pro event panel for status.';
            statusDiv.className = 'success';
        };
        // Custom file input logic
        var realFileInput = document.getElementById('scriptFileInput');
        var customFileButton = document.getElementById('customFileButton');
        var customFileName = document.getElementById('customFileName');
        customFileButton.onclick = function() {
            realFileInput.click();
        };
        customFileButton.onkeydown = function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                realFileInput.click();
            }
        };
        realFileInput.onchange = function() {
            if (realFileInput.files && realFileInput.files.length > 0) {
                customFileName.textContent = realFileInput.files[0].name;
            } else {
                customFileName.textContent = 'No file chosen';
            }
        };
        // No custom number input arrow logic needed; use native input
        // Help modal logic
        var helpBtn = document.getElementById('helpBtn');
        var helpModalBackdrop = document.getElementById('helpModalBackdrop');
        var closeHelpModal = document.getElementById('closeHelpModal');
        helpBtn.onclick = function() {
            helpModalBackdrop.style.display = 'flex';
            // Trap focus inside modal
            closeHelpModal.focus();
        };
        closeHelpModal.onclick = function() {
            helpModalBackdrop.style.display = 'none';
        };
        helpModalBackdrop.onclick = function(e) {
            if (e.target === helpModalBackdrop) helpModalBackdrop.style.display = 'none';
        };
        document.addEventListener('keydown', function(e) {
            if (helpModalBackdrop.style.display === 'flex' && (e.key === 'Escape' || e.key === 'Esc')) {
                helpModalBackdrop.style.display = 'none';
            }
        });
    </script>
</body>
</html>